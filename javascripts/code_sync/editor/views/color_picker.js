(function(){CodeSync.plugins.ColorPicker=Backbone.View.extend({className:"codesync-color-picker",spectrumOptions:{showAlpha:!1,preferredFormat:"hex6",flat:!0,showInput:!0,chooseText:"Choose"},initialize:function(e){return this.options=e!=null?e:{},_.extend(this,this.options),this.$el.append("<input type='color' class='color-picker-widget' />"),this.widget=this.$(".color-picker-widget")},remove:function(){return this.widget.spectrum("destroy"),this.$el.remove()},hide:function(){return this.widget.spectrum("hide"),this.$el.hide(),this.off("color:change")},show:function(){return this.widget.spectrum("show"),this.$el.show()},syncWithToken:function(e,t){var n,r,i,s,o=this;return n=this.editor.codeMirror,n.addWidget(t,this.el),this.show(),i=n.getLine(t.line),s=e.start,r=e.end,this.widget.spectrum("set",e.string),this.on("color:change",_.debounce(function(e,i){var u;return n.replaceRange("#"+i,{line:t.line,ch:s},{line:t.line,ch:r}),(u=o.editor.currentDocument)!=null?u.trigger("change:contents"):void 0}))},render:function(){var e,t=this;return e=_.extend(this.spectrumOptions,{move:_.debounce(function(e){return t.trigger("color:change",e,e.toHex())},200)}),this.widget.spectrum(this.spectrumOptions),this}}),CodeSync.plugins.ColorPicker.setup=function(e){var t;return this.colorPicker=new CodeSync.plugins.ColorPicker({editor:e}),this.$el.append(e.colorPicker.render().el),this.colorPicker.hide(),t=e.codeMirror,t.on("cursorActivity",function(){var n,r,i,s;return n=t.getCursor(),r=t.getTokenAt(n),((i=r.string)!=null?i.match(/#[a-fA-F0-9]{3,6}/g):void 0)&&((s=r.string)!=null?s.length:void 0)>=6?e.colorPicker.syncWithToken(r,n):e.colorPicker.hide()})}}).call(this);